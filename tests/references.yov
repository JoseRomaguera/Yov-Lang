
Foo :: struct {
    ref: Int&;
    val: Int;
    child: Foo&;
}

global_val := 0;
global_ref := &global_val;

main :: ()
{
    val0 := 4;
    ref0 := &val0;
    
    assert(val0 == ref0);
    val0 = 5;
    assert(val0 == ref0);
    ref0 = 6;
    assert(val0 == ref0);
    
    ref0 = global_ref;
    assert(val0 != ref0);
    
    ref0 = 7;
    assert(ref0 == global_ref && ref0 == global_val);
    
    foo0: Foo;
    foo0.ref = &val0;
    foo0.val = ref0;
    foo0.child = &foo0;
    
    assert(foo0.ref == val0);
    assert(foo0.val == 7 && foo0.val == foo0.child.val);
    
    foo1: Foo;
    foo1.child = &foo0;
    
    assert(foo0.val == foo1.child.val && foo1.val != foo1.child.val);
}